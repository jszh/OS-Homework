# lab1 SPOC思考题
https://github.com/chyyuu/os_course_exercises/blob/2018spring/all/02-2-lab1-spoc-discussion.md

## 思考题

### 启动顺序

1. 段寄存器的字段含义和功能有哪些？

 - 代码段寄存器 CS：存放当前程序代码的段基址
 - 数据段寄存器 DS：存放当前程序使用的数据的段基址
 - 堆栈段寄存器 SS：堆栈段的段基址
 - 附加段寄存器 ES：存放当前程序使用附加数据的段基址，该段是串操作指令中目的串所在的段

2. 描述符特权级DPL、当前特权级CPL和请求特权级RPL的含义是什么？在哪些寄存器中存在这些字段？对应的访问条件是什么？

 - CPL 是当前进程的权限级别，是当前正在执行的代码所在的段的特权级，存在于 CS 寄存器的低两位
 - RPL 是进程对段访问的请求权限，每个段选择子有自己的RPL，说明的是进程对段访问的请求权限
 - DPL 存储在段描述符中，规定访问该段的权限级别，每个段的 DPL 固定。

访问条件是 DPL >= max {CPL, RPL}

3. 分析可执行文件格式elf的格式（无需回答）

### 4.4 x86中断处理过程

1. 中断处理中硬件压栈内容？用户态中断和内核态中断的硬件压栈有什么不同？

硬件压栈内容：被中断进程的下条指令（CS, EIP）、EFLAG 压栈；如果发生用户态向内核态的切换，还会把用户态的 SS, ESP 压栈。
中断如果在用户态，会发生栈的切换问题，切换到内核态的栈；如果是在内核态，就不需要栈切换。

2. 为什么在用户态的中断响应要使用内核堆栈？

因为 x86 处理器在内核态（ring 0）上只有一个ESP，所以中断发生后，只能使用一个栈，也就是内核栈。

3. trap类型的中断门与interrupt类型的中断门有啥设置上的差别？如果在设置中断门上不做区分，会有什么可能的后果?

- interrupt 中断门：包含段选择符和中断或异常处理程序的段内偏移量。当控制权转移到一个适当的段时，处理器清 IF 标志，关中断。
- trap 中断门：与 interrupt 中断门相似，但是在控制权传递到一个适当的段时，不修改 IF 标志

因为陷阱可以嵌套发生，而中断默认不可以嵌套，所以要区分选择合适的门来处理

### 4.8 练习四和五 ucore内核映像加载和函数调用栈分析

1. 在kdebug.c文件中用到的函数`read_ebp`是内联的，而函数`read_eip`不是内联的。为什么要设计成这样？

### 4.9 练习六 完善中断初始化和处理

1. CPU加电初始化后中断是使能的吗？为什么？

初始化后，所有的中断都被禁止，直到通过软件初始化堆栈后才开放中断。
